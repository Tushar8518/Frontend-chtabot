<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WhatsApp-style Chatbot</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!-- Floating Chat Button -->
  <div id="chatbot-button">&#128172;</div>

  <!-- Chat Widget -->
  <div id="chatbot-widget">
    <div id="chatbot-header">
      Chat with AI
      <span id="chatbot-close">&times;</span>
    </div>
    <div id="chatbot-messages"></div>
    <div id="chatbot-input-area">
      <input type="text" id="chatbot-input" placeholder="Type your message...">
      <button id="chatbot-send">Send</button>
    </div>
  </div>

  <script>
    const chatbotButton = document.getElementById('chatbot-button');
    const chatbotWidget = document.getElementById('chatbot-widget');
    const chatbotClose = document.getElementById('chatbot-close');
    const chatbotMessages = document.getElementById('chatbot-messages');
    const chatbotInput = document.getElementById('chatbot-input');
    const chatbotSend = document.getElementById('chatbot-send');

    // Show/hide chatbot
    chatbotButton.onclick = () => chatbotWidget.style.display = 'flex';
    chatbotClose.onclick = () => chatbotWidget.style.display = 'none';

    // Add message to chat
    function addMessage(text, sender, typing=false){
        const div = document.createElement('div');
        div.className = 'message ' + sender;

        if(sender==='bot' && typing){
            div.classList.add('typing');
            div.innerHTML = '<span></span><span></span><span></span>';
        } else {
            div.textContent = text;
        }

        chatbotMessages.appendChild(div);
        chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        return div;
    }

    // Get AI response from backend
    async function getResponse(message){
        try {
            const res = await fetch("http://localhost:5000/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message })
            });
            const data = await res.json();
            return data.reply;
        } catch (err) {
            return "Sorry, I could not connect to AI.";
        }
    }

    // Send message
    async function sendMessage(){
        const text = chatbotInput.value.trim();
        if(!text) return;

        addMessage(text, 'user');
        chatbotInput.value = '';

        const botDiv = addMessage('', 'bot', true);

        const reply = await getResponse(text);
        botDiv.classList.remove('typing');
        botDiv.textContent = reply;
    }

    chatbotSend.onclick = sendMessage;
    chatbotInput.onkeydown = e => { if(e.key==='Enter') sendMessage(); };
  </script>

</body>
</html>
