<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WhatsApp-style Chatbot</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!-- Floating Chat Button -->
  <div id="chatbot-button">&#128172;</div>

  <!-- Chat Widget -->
  <div id="chatbot-widget">
    <div id="chatbot-header">
      Chat with AI
      <span id="chatbot-close">&times;</span>
    </div>
    <div id="chatbot-messages"></div>
    <div id="chatbot-input-area">
      <input type="text" id="chatbot-input" placeholder="Type your message...">
      <button id="chatbot-send">Send</button>
    </div>
  </div>

  <!-- Chatbot JS -->
  <script>
    const chatbotButton = document.getElementById('chatbot-button');
    const chatbotWidget = document.getElementById('chatbot-widget');
    const chatbotClose = document.getElementById('chatbot-close');
    const chatbotMessages = document.getElementById('chatbot-messages');
    const chatbotInput = document.getElementById('chatbot-input');
    const chatbotSend = document.getElementById('chatbot-send');

    // Show/hide chatbot
    chatbotButton.onclick = () => chatbotWidget.style.display = 'flex';
    chatbotClose.onclick = () => chatbotWidget.style.display = 'none';

    // Add message
    function addMessage(text, sender){
        const div = document.createElement('div');
        div.className = 'message ' + sender;

        // Typing indicator
        if(sender==='bot' && text==='Typing...'){
            div.classList.add('typing');
            div.innerHTML = '<span></span><span></span><span></span>';
        } else {
            div.textContent = text;
        }

        chatbotMessages.appendChild(div);
        chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
    }

    // Example responses
    async function getResponse(message) {
  try {
    const res = await fetch("http://localhost:5000/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message })
    });
    const data = await res.json();
    return data.reply;
  } catch (err) {
    return "Sorry, I could not connect to AI.";
  }
}


    // Send message
async function sendMessage() {
    const text = chatbotInput.value.trim();
    if (!text) return;

    // Show user's message
    addMessage(text, 'user');
    chatbotInput.value = '';

    // Show typing indicator for bot
    addMessage('Typing...', 'bot');

    // Get bot response from async API
    const botDiv = document.querySelector('.message.bot:last-child');

    try {
        const reply = await getResponse(text);  // await the async function
        botDiv.classList.remove('typing');
        botDiv.textContent = reply;
    } catch (err) {
        botDiv.classList.remove('typing');
        botDiv.textContent = "Sorry, I could not connect to AI.";
    }
}

    chatbotSend.onclick = sendMessage;
chatbotInput.onkeydown = e => { if(e.key === 'Enter') sendMessage(); };

  </script>

</body>
</html>
